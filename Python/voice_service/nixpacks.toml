[phases.setup]
nixPkgs = ["python311", "uv", "ffmpeg", "git"]
env = [
    "PYTHONUNBUFFERED=1",
    "PYTHONDONTWRITEBYTECODE=1"
]

[phases.build]
cmds = [
    "cd /app && uv sync --frozen --no-dev",
    "chmod +x start.sh",
    "chmod +x setup_voice_models.py"
]

[phases.install]
cmds = [
    "cd /app && source .venv/bin/activate",
    "cd /app && python setup_voice_models.py"
]

[start]
cmd = "cd /app && ./start.sh"

[env]
VOICE_SERVICE_SECRET = "hana_voice_shared_secret_2024_secure_key"
LOG_LEVEL = "INFO"
MAX_CONCURRENT_SESSIONS = "10"
RATE_LIMIT_PER_MINUTE = "60"
VOSK_MODEL_PATH = "models/vosk-model-ar-0.22-linto-1.1.0"
TTS_MODEL_NAME = "tts_models/multilingual/multi-dataset/xtts_v2"
SAMPLE_RATE = "16000"
AUDIO_FORMAT = "wav"
PROCESSING_TIMEOUT = "30"
SKIP_MODEL_LOADING = "false"

[volumes."/data/models"]
remote = "voice-models"
