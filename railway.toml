[build]
builder = "NIXPACKS"

[deploy]
numReplicas = 1

[[services]]
name = "hana-voice-saas"
sourcePath = "."
buildCommand = "npm install && npm run build"
startCommand = "npm start -- -p $PORT"
healthcheckPath = "/api/health"
healthcheckTimeout = 300

[services.env]
NODE_ENV = "production"

# Supabase Configuration (REQUIRED - Add your actual values)
NEXT_PUBLIC_SUPABASE_URL = "https://kycsfssbmeiwlxkaeyum.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5Y3Nmc3NibWVpd2x4a2FleXVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNzE3MDksImV4cCI6MjA3ODk0NzcwOX0.LuhtKOxxb7A1EIV__T8ydHvWCdh4FF31V_pDS3CS3No"

# Authentication & Security (REQUIRED - Generate secure values)
JWT_SECRET_KEY = "generate_jwt_secret_here"

# Voice Service Integration (OPTIONAL - Add your values if using voice features)
VOICE_SERVICE_URL = "https://hana-voice-service.up.railway.app"
VOICE_SERVICE_SECRET = "hana_voice_shared_secret_2024_secure_key"

# Admin Access (ADD VIA RAILWAY UI - Do not hardcode)
# ADMIN_USERNAME = "your_admin_username"
# ADMIN_PASSWORD = "your_secure_password"

[[services]]
name = "hana-voice-service"
sourcePath = "Python/voice_service"
buildCommand = "poetry install --no-dev"
startCommand = "poetry run uvicorn app.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
healthcheckTimeout = 300

[services.env]
VOICE_SERVICE_SECRET = "hana_voice_shared_secret_2024_secure_key"
LOG_LEVEL = "INFO"
MAX_CONCURRENT_SESSIONS = "10"
RATE_LIMIT_PER_MINUTE = "60"

# Note: For persistent storage (voice models), you'll need to:
# 1. Use Railway's Volume service for persistent storage
# 2. Mount the volume to /data/models in the Python service
# 3. Configure the volume in Railway dashboard
